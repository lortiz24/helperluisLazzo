!function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t,o){e.exports=o(3)},function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(4)),r=n(o(5));i.default.config();(new r.default).listen()},function(e,t){e.exports=require("dotenv")},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(0)),s=i(o(6)),u=o(7),a=i(o(8)),c=i(o(11));t.default=class{constructor(){this.app=(0,r.default)(),this.port="1755",this.movimientosRoute="/api/movimientos",this.api="/",this.dbConnection(),this.middlewares(),this.routes()}routes(){this.app.use(this.movimientosRoute,a.default),this.app.use(this.api,c.default)}middlewares(){this.app.use(r.default.json()),this.app.use((0,s.default)()),this.app.set("trust proxy",!0)}dbConnection(){return n(this,void 0,void 0,(function*(){yield(0,u.dbConnection)()}))}listen(){this.app.listen(this.port,()=>{console.log("Server on port "+this.port)})}}},function(e,t){e.exports=require("cors")},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.dbConnection=void 0;const r=i(o(1));t.dbConnection=()=>n(void 0,void 0,void 0,(function*(){try{yield r.default.connect("mongodb+srv://poseidon:Q401n38U6V5F2gsu@db-mongodb-prd-17966-c6c60132.mongo.ondigitalocean.com/afrodita?tls=true&authSource=admin&replicaSet=db-mongodb-prd-17966"),console.log("Database online")}catch(e){throw new Error(e.toString())}}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),i=o(9),r=(0,n.Router)();r.get("/obtener_ventas_duplicadas",i.getUsuarios),r.post("/delete_duplicados",i.deleteDuplicados),r.post("/delete_by_empresa_Jornada",i.deleteAllDuplicados),t.default=r},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function u(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteAllDuplicados=t.deleteDuplicados=t.getUsuarios=void 0;const r=i(o(10));t.getUsuarios=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{empresas_id:o,consecutivo_combustible:n}=e.body;let i={};o&&(i.empresas_id=o),n&&(i["data.ventas_combustible.consecutivo"]=n),console.log(i);const s=yield r.default.aggregate().match(i);t.send(s)}catch(e){t.json({error:e.message})}}));t.deleteDuplicados=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{empresas_id:o,consecutivo_combustible:n}=e.body,i=yield r.default.aggregate().match({empresas_id:o,"data.ventas_combustible.consecutivo":n});if(console.log(o,n),i.length>1){let e=[];i.map((t,o)=>{0!==o&&e.push(r.default.findByIdAndDelete(t._id))});const o=yield Promise.all(e);return t.send({backup:o})}t.send({msg:"No hay registros duplicados con ese consecutivo"})}catch(e){t.json({error:e.message})}}));t.deleteAllDuplicados=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{empresas_id:o,jornadaInicial:i,jonadaFinal:s}=e.body;let u=[1];const a=yield r.default.aggregate().match({empresas_id:o,jornada_id:{$gte:i,$lte:s}});console.log(a.length),a.map((e,t)=>{let i=!1;e.data.ventas_combustible.map((e,t)=>n(void 0,void 0,void 0,(function*(){if(i)return;const t=yield r.default.aggregate().match({empresas_id:o,"data.ventas_combustible.consecutivo":e.consecutivo});t.length>1&&(i=!0,console.log(1),t.map((e,t)=>n(void 0,void 0,void 0,(function*(){if(0===t)return;const o=yield r.default.findByIdAndDelete(e._id);u.push(o)}))))})))}),t.json({borradas:u})}catch(e){t.json({error:e.message})}}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const{Schema:n,model:i}=o(1),r=n({});t.default=i("detallado_cierre_diario",r,"detallado_cierre_diario")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=(0,o(0).Router)();n.get("/",(e,t)=>{t.json({delete_duplicado:"/api/movimientos/delete_duplicados"})}),t.default=n}]);